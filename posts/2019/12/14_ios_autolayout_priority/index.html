<!doctype html><html><meta charset=utf-8><meta name=generator content="Hugo 0.62.0"><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><meta name=color-scheme content="light dark"><meta name=supported-color-schemes content="light dark"><title>运用 AutoLayout 的优先级例子&nbsp;&ndash;&nbsp;LayoutBoy's notes</title><link rel=stylesheet href=/css/core.min.156cb90f4bced0bd73b07af1d3f960b8f6dbef58c7a9eee78cdb0b66771ade66235452e8607819dc9b5cb28d74d71bc7.css integrity=sha384-FWy5D0vO0L1zsHrx0/lguPbb71jHqe7njNsLZnca3mYjVFLoYHgZ3Jtcso101xvH><body><div class=base-body><section id=header class="site header max-body-width"><div class="header wrap"><span class="header left-side"><a class="site home" href=/><img class="site logo" src=/img/logo.png alt><span class="site name">LayoutBoy's notes</span></a></span>
<span class="header right-side"><a class="nav item" href=/pages/about/><span class="iconfont icon-aboutus"></span>&nbsp;About</a>
<a class="nav item" href=https://github.com/cntrump target=_blank><span class="iconfont icon-logo_github"></span>&nbsp;Github</a></span></div><div class="site slogan"><span class=title>&#xF8FF;页面仔的笔记</span></div></section><div id=content class=max-body-width><section class="article header"><h1 class="article title">运用 AutoLayout 的优先级例子</h1><p class="article date">Dec 14, 2019</p></section><article class="article markdown-body" style=text-align:justify><p>当约束条件发生冲突时，系统会使用用优先级高的约束。</p><p>还可以通过设置约束为 <code>deactive</code> 状态来使约束不生效。</p><p>利用好约束的优先级，可以使布局代码简洁、逻辑清晰。</p><p>系统原生的 AutoLayout 代码写起来太冗长了，使用 <a href=https://github.com/SnapKit/SnapKit target=_blank>SnapKit</a> 来演示如何运用约束优先级，方便理解逻辑。</p><h3 id=-1->场景 1 动态调整间距</h3><p>当有图片的时候布局如下：</p><p><span class=image-container><span class=link><a target=_blank rel="noopener noreferrer" href=01.png><img class=img src=01.png alt></a></span><span class=caption><span class=title>右侧有图片时</span></span></span></p><p>如果没有图片，文字布局如下：</p><p><span class=image-container><span class=link><a target=_blank rel="noopener noreferrer" href=02.png><img class=img src=02.png alt></a></span><span class=caption><span class=title>没有图片时</span></span></span></p><p>imageView 的布局代码：</p><div class=highlight><pre class=chroma><code class=language-swift data-lang=swift><span class=n>imageView</span><span class=p>.</span><span class=n>snp</span><span class=p>.</span><span class=n>makeConstraints</span> <span class=p>{</span> <span class=p>(</span><span class=n>make</span><span class=p>)</span> <span class=k>in</span>
    <span class=n>make</span><span class=p>.</span><span class=n>size</span><span class=p>.</span><span class=n>equalTo</span><span class=p>(</span><span class=n>CGSize</span><span class=p>(</span><span class=n>width</span><span class=p>:</span> <span class=mi>80</span><span class=p>,</span> <span class=n>height</span><span class=p>:</span> <span class=mi>80</span><span class=p>)</span><span class=p>)</span>
    <span class=n>make</span><span class=p>.</span><span class=n>top</span><span class=p>.</span><span class=n>equalTo</span><span class=p>(</span><span class=mi>100</span><span class=p>)</span>
    <span class=n>make</span><span class=p>.</span><span class=kr>right</span><span class=p>.</span><span class=n>equalTo</span><span class=p>(</span><span class=o>-</span><span class=mi>30</span><span class=p>)</span>
<span class=p>}</span>
</code></pre></div><p>titleLabel 的布局代码：</p><div class=highlight><pre class=chroma><code class=language-swift data-lang=swift><span class=kd>var</span> <span class=nv>c</span><span class=p>:</span> <span class=n>SnapKit</span><span class=p>.</span><span class=n>ConstraintMakerFinalizable</span><span class=p>!</span>

<span class=n>titleLabel</span><span class=p>.</span><span class=n>snp</span><span class=p>.</span><span class=n>makeConstraints</span> <span class=p>{</span> <span class=p>(</span><span class=n>make</span><span class=p>)</span> <span class=k>in</span>
    <span class=n>make</span><span class=p>.</span><span class=n>top</span><span class=p>.</span><span class=n>equalTo</span><span class=p>(</span><span class=mi>100</span><span class=p>)</span>
    <span class=n>make</span><span class=p>.</span><span class=kr>left</span><span class=p>.</span><span class=n>equalTo</span><span class=p>(</span><span class=mi>30</span><span class=p>)</span>
    <span class=n>c</span> <span class=p>=</span> <span class=n>make</span><span class=p>.</span><span class=kr>right</span><span class=p>.</span><span class=n>equalTo</span><span class=p>(</span><span class=n>imageView</span><span class=p>.</span><span class=n>snp</span><span class=p>.</span><span class=kr>left</span><span class=p>)</span><span class=p>.</span><span class=n>offset</span><span class=p>(</span><span class=o>-</span><span class=mi>10</span><span class=p>)</span>
    <span class=n>make</span><span class=p>.</span><span class=kr>right</span><span class=p>.</span><span class=n>equalTo</span><span class=p>(</span><span class=o>-</span><span class=mi>30</span><span class=p>)</span><span class=p>.</span><span class=n>priorityMedium</span><span class=p>(</span><span class=p>)</span>
<span class=p>}</span>
</code></pre></div><p>对于 UILabel ，还需要降低其抗压缩优先级：</p><div class=highlight><pre class=chroma><code class=language-swift data-lang=swift><span class=n>titleLabel</span><span class=p>.</span><span class=n>setContentCompressionResistancePriority</span><span class=p>(</span><span class=p>.</span><span class=n>defaultLow</span><span class=p>,</span> <span class=k>for</span><span class=p>:</span> <span class=p>.</span><span class=n>horizontal</span><span class=p>)</span>
</code></pre></div><p>对 titleLable 添加两条 right 约束，并降低其中一条的优先级为 medium：</p><div class=highlight><pre class=chroma><code class=language-swift data-lang=swift><span class=n>make</span><span class=p>.</span><span class=kr>right</span><span class=p>.</span><span class=n>equalTo</span><span class=p>(</span><span class=n>imageView</span><span class=p>.</span><span class=n>snp</span><span class=p>.</span><span class=kr>left</span><span class=p>)</span><span class=p>.</span><span class=n>offset</span><span class=p>(</span><span class=o>-</span><span class=mi>10</span><span class=p>)</span>
<span class=n>make</span><span class=p>.</span><span class=kr>right</span><span class=p>.</span><span class=n>equalTo</span><span class=p>(</span><span class=o>-</span><span class=mi>30</span><span class=p>)</span><span class=p>.</span><span class=n>priorityMedium</span><span class=p>(</span><span class=p>)</span>
</code></pre></div><p>当需要显示图片时：</p><div class=highlight><pre class=chroma><code class=language-swift data-lang=swift><span class=n>imageView</span><span class=p>.</span><span class=n>isHidden</span> <span class=p>=</span> <span class=kc>false</span>
<span class=n>c</span><span class=p>.</span><span class=n>constraint</span><span class=p>.</span><span class=n>activate</span><span class=p>(</span><span class=p>)</span>
</code></pre></div><p>没有图片时，隐藏 imageView：</p><div class=highlight><pre class=chroma><code class=language-swift data-lang=swift><span class=n>imageView</span><span class=p>.</span><span class=n>isHidden</span> <span class=p>=</span> <span class=kc>true</span>
<span class=n>c</span><span class=p>.</span><span class=n>constraint</span><span class=p>.</span><span class=n>deactivate</span><span class=p>(</span><span class=p>)</span>
</code></pre></div><h3 id=-2->场景 2 动态调整宽度</h3><p>布局需要满足以下需求：</p><ol><li>在<strong>手机</strong>上保持左右间距为：15</li><li>在<strong>平板</strong>上使用固定宽度：320</li></ol><p>手机上的布局效果：</p><p><span class=image-container><span class=link><a target=_blank rel="noopener noreferrer" href=03.png><img class=img src=03.png alt></a></span><span class=caption><span class=title>手机</span></span></span></p><p>平板上的布局效果：</p><p><span class=image-container><span class=link><a target=_blank rel="noopener noreferrer" href=04.png><img class=img src=04.png alt></a></span><span class=caption><span class=title>平板</span></span></span></p><p>可以把平板抽象为与设备无关的逻辑，目前手机上最大的尺寸是 <code>Pro Max</code>，它的屏幕宽度是 414。</p><p>宽度大于 414 就认为是运行于平板设备上。</p><p>布局代码如下：</p><div class=highlight><pre class=chroma><code class=language-swift data-lang=swift><span class=kd>var</span> <span class=nv>c</span><span class=p>:</span> <span class=n>SnapKit</span><span class=p>.</span><span class=n>ConstraintMakerFinalizable</span><span class=p>!</span>

<span class=n>containerView</span><span class=p>.</span><span class=n>snp</span><span class=p>.</span><span class=n>makeConstraints</span> <span class=p>{</span> <span class=p>(</span><span class=n>make</span><span class=p>)</span> <span class=k>in</span>
    <span class=n>make</span><span class=p>.</span><span class=kr>left</span><span class=p>.</span><span class=n>equalTo</span><span class=p>(</span><span class=mi>15</span><span class=p>)</span><span class=p>.</span><span class=n>priorityLow</span><span class=p>(</span><span class=p>)</span>
    <span class=n>make</span><span class=p>.</span><span class=kr>right</span><span class=p>.</span><span class=n>equalTo</span><span class=p>(</span><span class=o>-</span><span class=mi>15</span><span class=p>)</span><span class=p>.</span><span class=n>priorityLow</span><span class=p>(</span><span class=p>)</span>
    <span class=n>c</span> <span class=p>=</span> <span class=n>make</span><span class=p>.</span><span class=n>width</span><span class=p>.</span><span class=n>equalTo</span><span class=p>(</span><span class=mi>320</span><span class=p>)</span><span class=p>.</span><span class=n>priorityMedium</span><span class=p>(</span><span class=p>)</span>
    <span class=n>make</span><span class=p>.</span><span class=n>centerX</span><span class=p>.</span><span class=n>equalTo</span><span class=p>(</span><span class=n>view</span><span class=p>)</span>
    <span class=n>make</span><span class=p>.</span><span class=n>height</span><span class=p>.</span><span class=n>equalTo</span><span class=p>(</span><span class=mi>200</span><span class=p>)</span>

    <span class=k>if</span> <span class=cp>#available</span><span class=p>(</span><span class=cp>iOS</span> <span class=mf>11.0</span><span class=p>,</span> <span class=o>*</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>make</span><span class=p>.</span><span class=n>bottom</span><span class=p>.</span><span class=n>equalTo</span><span class=p>(</span><span class=n>view</span><span class=p>.</span><span class=n>safeAreaLayoutGuide</span><span class=p>.</span><span class=n>snp</span><span class=p>.</span><span class=n>bottom</span><span class=p>)</span><span class=p>.</span><span class=n>offset</span><span class=p>(</span><span class=o>-</span><span class=mi>30</span><span class=p>)</span>
    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
        <span class=n>make</span><span class=p>.</span><span class=n>bottom</span><span class=p>.</span><span class=n>equalTo</span><span class=p>(</span><span class=o>-</span><span class=mi>30</span><span class=p>)</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div><p>通过约束 <code>left</code> 和 <code>right</code> 就能确定宽度了，再添加一条设置 <code>width</code> 的约束来控制最小宽度。</p><p>添加的 <code>centerX</code> 约束是保证 <code>width</code> 约束生效的时候能确定其 X 坐标位置。</p><p>不同屏幕尺寸下的显示逻辑：</p><div class=highlight><pre class=chroma><code class=language-swift data-lang=swift><span class=k>if</span> <span class=n>view</span><span class=p>.</span><span class=n>frame</span><span class=p>.</span><span class=n>width</span> <span class=o>&lt;=</span> <span class=mi>414</span> <span class=p>{</span>
    <span class=n>c</span><span class=p>.</span><span class=n>constraint</span><span class=p>.</span><span class=n>deactivate</span><span class=p>(</span><span class=p>)</span>
<span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
    <span class=n>c</span><span class=p>.</span><span class=n>constraint</span><span class=p>.</span><span class=n>activate</span><span class=p>(</span><span class=p>)</span>
<span class=p>}</span>
</code></pre></div><h3 id=-3->场景 3 保持最小间距同时限制最大宽度</h3><p>布局要求满足以下需求：</p><ol><li>在 5s 上左右间距为 20</li><li>在 6 plus 以及更宽的屏幕上保持最大宽度为 335</li><li>水平居中显示</li></ol><p>利用约束优先级来实现非常简单，实现代码如下：</p><div class=highlight><pre class=chroma><code class=language-swift data-lang=swift><span class=n>containerView</span><span class=p>.</span><span class=n>snp</span><span class=p>.</span><span class=n>makeConstraints</span> <span class=p>{</span> <span class=p>(</span><span class=n>make</span><span class=p>)</span> <span class=k>in</span>
    <span class=n>make</span><span class=p>.</span><span class=kr>left</span><span class=p>.</span><span class=n>greaterThanOrEqualTo</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span><span class=p>.</span><span class=n>priorityHigh</span><span class=p>(</span><span class=p>)</span>
    <span class=n>make</span><span class=p>.</span><span class=kr>right</span><span class=p>.</span><span class=n>lessThanOrEqualTo</span><span class=p>(</span><span class=o>-</span><span class=mi>20</span><span class=p>)</span><span class=p>.</span><span class=n>priorityHigh</span><span class=p>(</span><span class=p>)</span>
    <span class=n>make</span><span class=p>.</span><span class=n>width</span><span class=p>.</span><span class=n>equalTo</span><span class=p>(</span><span class=mi>335</span><span class=p>)</span><span class=p>.</span><span class=n>priorityMedium</span><span class=p>(</span><span class=p>)</span>
    <span class=n>make</span><span class=p>.</span><span class=n>centerX</span><span class=p>.</span><span class=n>equalTo</span><span class=p>(</span><span class=n>view</span><span class=p>)</span>
<span class=p>}</span>
</code></pre></div><h3 id=-4--uiscrollview->场景 4 在 UIScrollView 里居中</h3><p>布局要求满足以下需求：</p><ol><li>上下保留最小间距 20</li><li>左右保留最小间距 20</li><li>如果空间足够则居中显示</li><li>空间不够需要能滑动查看</li><li>宽和高为 335 x 520</li></ol><p>UIScrollView 的子控件使用自动布局时，<code>contentSize</code> 的<strong>大小</strong>由子控件的<strong>水平约束</strong>和<strong>垂直约束</strong>决定。</p><p>实现代码：</p><div class=highlight><pre class=chroma><code class=language-swift data-lang=swift><span class=n>containerView</span><span class=p>.</span><span class=n>snp</span><span class=p>.</span><span class=n>makeConstraints</span> <span class=p>{</span> <span class=p>(</span><span class=n>make</span><span class=p>)</span> <span class=k>in</span>
    <span class=c1>//</span><span class=c1> </span><span class=c1>水</span><span class=c1>平</span><span class=c1>方</span><span class=c1>向</span><span class=c1>的</span><span class=c1>约</span><span class=c1>束</span>
    <span class=n>make</span><span class=p>.</span><span class=kr>left</span><span class=p>.</span><span class=n>greaterThanOrEqualTo</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span><span class=p>.</span><span class=n>priorityHigh</span><span class=p>(</span><span class=p>)</span>
    <span class=n>make</span><span class=p>.</span><span class=kr>right</span><span class=p>.</span><span class=n>lessThanOrEqualTo</span><span class=p>(</span><span class=o>-</span><span class=mi>20</span><span class=p>)</span><span class=p>.</span><span class=n>priorityHigh</span><span class=p>(</span><span class=p>)</span>
    <span class=n>make</span><span class=p>.</span><span class=n>width</span><span class=p>.</span><span class=n>equalTo</span><span class=p>(</span><span class=mi>335</span><span class=p>)</span><span class=p>.</span><span class=n>priorityMedium</span><span class=p>(</span><span class=p>)</span>
    <span class=n>make</span><span class=p>.</span><span class=n>centerX</span><span class=p>.</span><span class=n>equalTo</span><span class=p>(</span><span class=n>scrollView</span><span class=p>)</span>
    <span class=c1>//</span><span class=c1> </span><span class=c1>垂</span><span class=c1>直</span><span class=c1>方</span><span class=c1>向</span><span class=c1>的</span><span class=c1>约</span><span class=c1>束</span>
    <span class=n>make</span><span class=p>.</span><span class=n>top</span><span class=p>.</span><span class=n>greaterThanOrEqualTo</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span><span class=p>.</span><span class=n>priorityHigh</span><span class=p>(</span><span class=p>)</span>
    <span class=n>make</span><span class=p>.</span><span class=n>bottom</span><span class=p>.</span><span class=n>lessThanOrEqualTo</span><span class=p>(</span><span class=o>-</span><span class=mi>20</span><span class=p>)</span><span class=p>.</span><span class=n>priorityHigh</span><span class=p>(</span><span class=p>)</span>
    <span class=n>make</span><span class=p>.</span><span class=n>height</span><span class=p>.</span><span class=n>equalTo</span><span class=p>(</span><span class=mi>520</span><span class=p>)</span><span class=p>.</span><span class=n>priorityMedium</span><span class=p>(</span><span class=p>)</span>
    <span class=n>make</span><span class=p>.</span><span class=n>centerY</span><span class=p>.</span><span class=n>equalTo</span><span class=p>(</span><span class=n>scrollView</span><span class=p>)</span><span class=p>.</span><span class=n>priorityMedium</span><span class=p>(</span><span class=p>)</span>
<span class=p>}</span>
</code></pre></div><p>（完）</p></article><section class="article labels"><a class="article tag" href=/tags/ios/><span class=hashtag>#</span>iOS</a></section><section class="article navigation"><p><a class=link href=/posts/2019/12/16_float_short/><span class=li></span>iOS 格式化浮点数时去掉末尾的 0</a></p><p><a class=link href=/posts/2019/12/11_export_all_chroma_themes/><span class=li></span>导出全部 Chroma 主题 CSS 文件</a class="link"></p></section></div><section id=footer class="footer max-body-width"><div class=footer-wrap><p class=copyright>&copy;2019 LayoutBoy.</p><p class=powerby><span>Powered by </span><a href=https://gohugo.io target=_blank>Hugo</a><span> and the </span><a href=https://themes.gohugo.io/hugo-notepadium/ target=_blank>Notepadium</a></p></div></section><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-155172933-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></div></body></html>