<!doctype html><html lang=zh><meta charset=utf-8><meta name=generator content="Hugo 0.69.0"><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><meta name=color-scheme content="light dark"><meta name=supported-color-schemes content="light dark"><title>在 iOS 里 100% 还原 Sketch 实现的阴影效果&nbsp;&ndash;&nbsp;&#xF8FF;页面仔的笔记</title><link rel=stylesheet href=/css/core.min.06eab1d4ec168fa5639a3d198a64bc281d84a0a6063b68163232db07edec11424e76d34a8e18de8baa6f71eaf64e3bde.css integrity=sha384-Buqx1OwWj6Vjmj0ZimS8KB2EoKYGO2gWMjLbB+3sEUJOdtNKjhjei6pvcer2Tjve><meta name=twitter:card content="summary"><meta name=twitter:title content="在 iOS 里 100% 还原 Sketch 实现的阴影效果"><meta name=twitter:image content="https://layoutboy.com/posts/2019/11/19_ios_sketch_shadow/01.png"><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#00a300"><meta name=theme-color content="#ffffff"><body><div class=base-body><section id=header class="site header"><div class="header wrap"><span class="header left-side"><a class="site home" href=/><img class="site logo" src=/apple-touch-icon.png alt><span class="site name">&#xF8FF;页面仔的笔记</span></a></span>
<span class="header right-side"><a class="nav item" href=https://github.com/cntrump target=_blank><span class="iconfont icon-logo_github"></span>&nbsp;Github</a></span></div></section><div id=content><div class=article-container><section class="article header"><h1 class="article title">在 iOS 里 100% 还原 Sketch 实现的阴影效果</h1><p class="article date">Nov 19, 2019<span class=reading-time> • 预计阅读时间 2 分钟</span></p></section><article class="article markdown-body"><blockquote><p>还原不了设计师视觉稿的开发者不是一个合格的页面仔。</p></blockquote><p>Sketch 是 APP 设计的神器，大部分设计师都选择它作为 APP 界面的设计工具。<br>在 Sketch 里设置一个阴影，效果图和参数如下：</p><p><span class=image-container><span class=link><a target=_blank rel="noopener noreferrer" href=01.png><img class=img src=01.png alt></a></span><span class=caption><span class=title>（Sketch 里的效果）</span></span></span></p><p><span class=image-container><span class=link><a target=_blank rel="noopener noreferrer" href=02.jpeg><img class=img src=02.jpeg alt></a></span><span class=caption><span class=title>（Sketch 里的阴影参数）</span></span></span></p><h3 id=开发实现>开发实现</h3><p>在 iOS 里实现阴影的方式是使用 UIView 的 layer 属性。<br>layer 里与阴影有关的设置是以下几个属性：</p><ul><li>shadowPath</li><li>shadowColor</li><li>shadowOpacity</li><li>shadowOffset</li><li>shadowRadius</li></ul><p>与 Sketch 里阴影参数的对应关系是：</p><ul><li>shadowPath ~> 阴影的<strong>范围</strong></li><li>shadowColor ~> 阴影的<strong>颜色</strong></li><li>shadowOpacity ~> 阴影的<strong>透明度</strong></li><li>shadowOffset ~> <strong>X</strong> 和 <strong>Y</strong></li><li>shadowRadius ~> 阴影的<strong>模糊</strong></li></ul><p><span class=image-container><span class=link><a target=_blank rel="noopener noreferrer" href=03.jpeg><img class=img src=03.jpeg alt></a></span><span class=caption><span class=title>（layer 属性和 Sketch 阴影的对应关系）</span></span></span></p><p>根据上图的对应关系，在代码里实现就是（shadowView 的大小是 100x100）：</p><div class=highlight><pre class=chroma><code class=language-swift data-lang=swift><span class=kd>let</span> <span class=nv>layer</span> <span class=p>=</span> <span class=n>shadowView</span><span class=p>.</span><span class=n>layer</span>
<span class=c1>// spread 对应 Sketch 里阴影的 “扩展”，值是 10</span>
<span class=kd>let</span> <span class=nv>spread</span><span class=p>:</span> <span class=n>CGFloat</span> <span class=p>=</span> <span class=mi>10</span>
<span class=kd>var</span> <span class=nv>rect</span> <span class=p>=</span> <span class=n>CGRect</span><span class=p>(</span><span class=n>x</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span> <span class=n>y</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span> <span class=n>width</span><span class=p>:</span> <span class=mi>100</span><span class=p>,</span> <span class=n>height</span><span class=p>:</span> <span class=mi>100</span><span class=p>);</span>
<span class=n>rect</span> <span class=p>=</span> <span class=n>rect</span><span class=p>.</span><span class=n>insetBy</span><span class=p>(</span><span class=n>dx</span><span class=p>:</span> <span class=o>-</span><span class=n>spread</span><span class=p>,</span> <span class=n>dy</span><span class=p>:</span> <span class=o>-</span><span class=n>spread</span><span class=p>)</span>

<span class=n>layer</span><span class=p>.</span><span class=n>shadowPath</span> <span class=p>=</span> <span class=n>UIBezierPath</span><span class=p>(</span><span class=n>rect</span><span class=p>:</span> <span class=n>rect</span><span class=p>).</span><span class=n>cgPath</span>
<span class=c1>// 颜色是黑色（ #000000 ）</span>
<span class=n>layer</span><span class=p>.</span><span class=n>shadowColor</span> <span class=p>=</span> <span class=n>UIColor</span><span class=p>.</span><span class=n>black</span><span class=p>.</span><span class=n>cgColor</span>
<span class=c1>// alpha 50</span>
<span class=n>layer</span><span class=p>.</span><span class=n>shadowOpacity</span> <span class=p>=</span> <span class=mf>0.5</span>
<span class=c1>// X: 0  Y: 10</span>
<span class=n>layer</span><span class=p>.</span><span class=n>shadowOffset</span> <span class=p>=</span> <span class=n>CGSize</span><span class=p>(</span><span class=n>width</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span> <span class=n>height</span><span class=p>:</span> <span class=mi>10</span><span class=p>)</span>
<span class=c1>// 对应 Sketch 里阴影的 “模糊” 的设置，值是 20 / 2 = 10</span>
<span class=n>layer</span><span class=p>.</span><span class=n>shadowRadius</span> <span class=p>=</span> <span class=mi>10</span>
</code></pre></div><p>以上代码运行的效果如下：</p><p><span class=image-container><span class=link><a target=_blank rel="noopener noreferrer" href=04.png><img class=img src=04.png alt></a></span><span class=caption><span class=title>（实现效果）</span></span></span></p><p>100% 还原了 Sketch 的设计，完美了。<br>值得一提的是：layer 阴影和圆角是可以共存的，而且阴影路径也需要考虑圆角的值。<br>为了使用方便，为 CALayer 添加一个设置阴影的扩展：</p><div class=highlight><pre class=chroma><code class=language-swift data-lang=swift><span class=kd>extension</span> <span class=nc>CALayer</span> <span class=p>{</span>
    <span class=kd>func</span> <span class=nf>skt_setShadow</span><span class=p>(</span><span class=n>color</span><span class=p>:</span> <span class=n>UIColor</span><span class=p>?</span> <span class=p>=</span> <span class=p>.</span><span class=n>black</span><span class=p>,</span>
                       <span class=n>alpha</span><span class=p>:</span> <span class=n>CGFloat</span> <span class=p>=</span> <span class=mf>0.5</span><span class=p>,</span>
                       <span class=n>x</span><span class=p>:</span> <span class=n>CGFloat</span> <span class=p>=</span> <span class=mi>0</span><span class=p>,</span> <span class=n>y</span><span class=p>:</span> <span class=n>CGFloat</span> <span class=p>=</span> <span class=mi>2</span><span class=p>,</span>
                       <span class=n>blur</span><span class=p>:</span> <span class=n>CGFloat</span> <span class=p>=</span> <span class=mi>4</span><span class=p>,</span>
                       <span class=n>spread</span><span class=p>:</span> <span class=n>CGFloat</span> <span class=p>=</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>shadowOffset</span> <span class=p>=</span> <span class=n>CGSize</span><span class=p>(</span><span class=n>width</span><span class=p>:</span> <span class=n>x</span><span class=p>,</span> <span class=n>height</span><span class=p>:</span> <span class=n>y</span><span class=p>)</span>
        <span class=n>shadowRadius</span> <span class=p>=</span> <span class=n>blur</span> <span class=o>*</span> <span class=mf>0.5</span>
        <span class=n>shadowColor</span> <span class=p>=</span> <span class=n>color</span><span class=p>?.</span><span class=n>cgColor</span>
        <span class=n>shadowOpacity</span> <span class=p>=</span> <span class=nb>Float</span><span class=p>(</span><span class=n>alpha</span><span class=p>)</span>

        <span class=kd>let</span> <span class=nv>rect</span> <span class=p>=</span> <span class=n>bounds</span><span class=p>.</span><span class=n>insetBy</span><span class=p>(</span><span class=n>dx</span><span class=p>:</span> <span class=o>-</span><span class=n>spread</span><span class=p>,</span> <span class=n>dy</span><span class=p>:</span> <span class=o>-</span><span class=n>spread</span><span class=p>)</span>
        <span class=kd>let</span> <span class=nv>path</span> <span class=p>=</span> <span class=n>UIBezierPath</span><span class=p>(</span><span class=n>roundedRect</span><span class=p>:</span> <span class=n>rect</span><span class=p>,</span> <span class=n>cornerRadius</span><span class=p>:</span> <span class=n>cornerRadius</span><span class=p>)</span>
        <span class=n>shadowPath</span> <span class=p>=</span> <span class=n>path</span><span class=p>.</span><span class=n>cgPath</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div><p>使用很简单，传入的值和 Sketch 里的阴影参数一样就行：</p><div class=highlight><pre class=chroma><code class=language-swift data-lang=swift><span class=n>layer</span><span class=p>.</span><span class=n>skt_setShadow</span><span class=p>(</span><span class=n>color</span><span class=p>:</span> <span class=p>.</span><span class=n>black</span><span class=p>,</span> <span class=n>alpha</span><span class=p>:</span> <span class=mf>0.5</span><span class=p>,</span>
                    <span class=n>x</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span> <span class=n>y</span><span class=p>:</span> <span class=mi>10</span><span class=p>,</span> 
                    <span class=n>blur</span><span class=p>:</span> <span class=mi>20</span><span class=p>,</span> 
                    <span class=n>spread</span><span class=p>:</span> <span class=mi>10</span><span class=p>)</span>
</code></pre></div></article><section class="article labels"><a class=tag href=/tags/ios/>iOS</a></section></div><section class="article navigation"><p><a class=link href=/posts/2019/11/20_git_tricks/><span class=li>&larr;</span>Git 操作技巧</a></p><p><a class=link href=/posts/2019/11/18_iosdevicesupport/><span class=li>&rarr;</span>给 Xcode 添加最新的 iOS DeviceSupport</a></p></section></div><section id=footer class=footer><div class=footer-wrap><p class=copyright>&copy;2020 LayoutBoy.</p><p class=powerby><span>Powered by </span><a href=https://gohugo.io target=_blank>Hugo</a><span> and the </span><a href=https://themes.gohugo.io/hugo-notepadium/ target=_blank>Notepadium</a></p></div></section><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-155172933-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></div></body></html>