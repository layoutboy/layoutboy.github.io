<!doctype html><html><meta charset=utf-8><meta name=generator content="Hugo 0.62.0"><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><meta name=color-scheme content="light only"><meta name=supported-color-schemes content="light only"><title>在 iOS 里 100% 还原 Sketch 实现的阴影效果&nbsp;&ndash;&nbsp;LayoutBoy</title><link rel=stylesheet href=/css/core.min.b1ca78a9bef956c72b2f1a7260faf4189a6106c781c5c464dbebb6d9888939b87f516cdd2c74aca2e003bd38f8345750.css integrity=sha384-scp4qb75VscrLxpyYPr0GJphBseBxcRk2+u22YiJObh/UWzdLHSsouADvTj4NFdQ><body><div class="base-body max-width"><section id=header class="header max-body-width"><div class=header-left-side><a class=home href=/><img class=site-logo src=/img/logo.jpg alt><span class=site-slogan>&#xF8FF;页面仔的笔记</span></a></div><div class=header-right-side><a class=article-tag href=/tags/ios/>iOS</a>
<a class=article-tag href=/tags/swift/>Swift</a>
<a class=article-tag href=/tags/>Tags</a>
<a class=article-tag href=https://github.com/cntrump target=_blank>Github</a></div></section><div id=content class="flex-body max-body-width"><section class=article-header style=text-align:justify><h1>在 iOS 里 100% 还原 Sketch 实现的阴影效果</h1><p class=article-date>2019-11-19</p></section><article class=markdown-body style=text-align:justify><blockquote><p>还原不了设计师视觉稿的开发者不是一个合格的页面仔。</p></blockquote><p>Sketch 是 APP 设计的神器，大部分设计师都选择它作为 APP 界面的设计工具。<br>在 Sketch 里设置一个阴影，效果图和参数如下：</p><p><span class=image-container><span class=link><a target=_blank rel="noopener noreferrer" href=01.png><img class=img src=01.png alt></a></span><span class=caption><span class=title>（Sketch 里的效果）</span></span></span></p><p><span class=image-container><span class=link><a target=_blank rel="noopener noreferrer" href=02.jpeg><img class=img src=02.jpeg alt></a></span><span class=caption><span class=title>（Sketch 里的阴影参数）</span></span></span></p><h3 id=heading>开发实现</h3><p>在 iOS 里实现阴影的方式是使用 UIView 的 layer 属性。<br>layer 里与阴影有关的设置是以下几个属性：</p><ul><li>shadowPath</li><li>shadowColor</li><li>shadowOpacity</li><li>shadowOffset</li><li>shadowRadius</li></ul><p>与 Sketch 里阴影参数的对应关系是：</p><ul><li>shadowPath ~> 阴影的<strong>范围</strong></li><li>shadowColor ~> 阴影的<strong>颜色</strong></li><li>shadowOpacity ~> 阴影的<strong>透明度</strong></li><li>shadowOffset ~> <strong>X</strong> 和 <strong>Y</strong></li><li>shadowRadius ~> 阴影的<strong>模糊</strong></li></ul><p><span class=image-container><span class=link><a target=_blank rel="noopener noreferrer" href=03.jpeg><img class=img src=03.jpeg alt></a></span><span class=caption><span class=title>（layer 属性和 Sketch 阴影的对应关系）</span></span></span></p><p>根据上图的对应关系，在代码里实现就是（shadowView 的大小是 100x100）：</p><div class=highlight><pre class=chroma><code class=language-swift data-lang=swift><span class=kd>let</span> <span class=nv>layer</span> <span class=p>=</span> <span class=n>shadowView</span><span class=p>.</span><span class=n>layer</span>
<span class=c1>//</span><span class=c1> </span><span class=c1>s</span><span class=c1>p</span><span class=c1>r</span><span class=c1>e</span><span class=c1>a</span><span class=c1>d</span><span class=c1> </span><span class=c1>对</span><span class=c1>应</span><span class=c1> </span><span class=c1>S</span><span class=c1>k</span><span class=c1>e</span><span class=c1>t</span><span class=c1>c</span><span class=c1>h</span><span class=c1> </span><span class=c1>里</span><span class=c1>阴</span><span class=c1>影</span><span class=c1>的</span><span class=c1> </span><span class=c1>“</span><span class=c1>扩</span><span class=c1>展</span><span class=c1>”</span><span class=c1>，</span><span class=c1>值</span><span class=c1>是</span><span class=c1> </span><span class=c1>1</span><span class=c1>0</span>
<span class=kd>let</span> <span class=nv>spread</span><span class=p>:</span> <span class=n>CGFloat</span> <span class=p>=</span> <span class=mi>10</span>
<span class=kd>var</span> <span class=nv>rect</span> <span class=p>=</span> <span class=n>CGRect</span><span class=p>(</span><span class=n>x</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span> <span class=n>y</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span> <span class=n>width</span><span class=p>:</span> <span class=mi>100</span><span class=p>,</span> <span class=n>height</span><span class=p>:</span> <span class=mi>100</span><span class=p>)</span><span class=p>;</span>
<span class=n>rect</span> <span class=p>=</span> <span class=n>rect</span><span class=p>.</span><span class=n>insetBy</span><span class=p>(</span><span class=n>dx</span><span class=p>:</span> <span class=o>-</span><span class=n>spread</span><span class=p>,</span> <span class=n>dy</span><span class=p>:</span> <span class=o>-</span><span class=n>spread</span><span class=p>)</span>

<span class=n>layer</span><span class=p>.</span><span class=n>shadowPath</span> <span class=p>=</span> <span class=n>UIBezierPath</span><span class=p>(</span><span class=n>rect</span><span class=p>:</span> <span class=n>rect</span><span class=p>)</span><span class=p>.</span><span class=n>cgPath</span>
<span class=c1>//</span><span class=c1> </span><span class=c1>颜</span><span class=c1>色</span><span class=c1>是</span><span class=c1>黑</span><span class=c1>色</span><span class=c1>（</span><span class=c1> </span><span class=c1>#</span><span class=c1>0</span><span class=c1>0</span><span class=c1>0</span><span class=c1>0</span><span class=c1>0</span><span class=c1>0</span><span class=c1> </span><span class=c1>）</span>
<span class=n>layer</span><span class=p>.</span><span class=n>shadowColor</span> <span class=p>=</span> <span class=n>UIColor</span><span class=p>.</span><span class=n>black</span><span class=p>.</span><span class=n>cgColor</span>
<span class=c1>//</span><span class=c1> </span><span class=c1>a</span><span class=c1>l</span><span class=c1>p</span><span class=c1>h</span><span class=c1>a</span><span class=c1> </span><span class=c1>5</span><span class=c1>0</span>
<span class=n>layer</span><span class=p>.</span><span class=n>shadowOpacity</span> <span class=p>=</span> <span class=mf>0.5</span>
<span class=c1>//</span><span class=c1> </span><span class=c1>X</span><span class=c1>:</span><span class=c1> </span><span class=c1>0</span><span class=c1> </span><span class=c1> </span><span class=c1>Y</span><span class=c1>:</span><span class=c1> </span><span class=c1>1</span><span class=c1>0</span>
<span class=n>layer</span><span class=p>.</span><span class=n>shadowOffset</span> <span class=p>=</span> <span class=n>CGSize</span><span class=p>(</span><span class=n>width</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span> <span class=n>height</span><span class=p>:</span> <span class=mi>10</span><span class=p>)</span>
<span class=c1>//</span><span class=c1> </span><span class=c1>对</span><span class=c1>应</span><span class=c1> </span><span class=c1>S</span><span class=c1>k</span><span class=c1>e</span><span class=c1>t</span><span class=c1>c</span><span class=c1>h</span><span class=c1> </span><span class=c1>里</span><span class=c1>阴</span><span class=c1>影</span><span class=c1>的</span><span class=c1> </span><span class=c1>“</span><span class=c1>模</span><span class=c1>糊</span><span class=c1>”</span><span class=c1> </span><span class=c1>的</span><span class=c1>设</span><span class=c1>置</span><span class=c1>，</span><span class=c1>值</span><span class=c1>是</span><span class=c1> </span><span class=c1>2</span><span class=c1>0</span><span class=c1> </span><span class=c1>/</span><span class=c1> </span><span class=c1>2</span><span class=c1> </span><span class=c1>=</span><span class=c1> </span><span class=c1>1</span><span class=c1>0</span>
<span class=n>layer</span><span class=p>.</span><span class=n>shadowRadius</span> <span class=p>=</span> <span class=mi>10</span>
</code></pre></div><p>以上代码运行的效果如下：</p><p><span class=image-container><span class=link><a target=_blank rel="noopener noreferrer" href=04.png><img class=img src=04.png alt></a></span><span class=caption><span class=title>（实现效果）</span></span></span></p><p>100% 还原了 Sketch 的设计，完美了。<br>值得一提的是：layer 阴影和圆角是可以共存的，而且阴影路径也需要考虑圆角的值。<br>为了使用方便，为 CALayer 添加一个设置阴影的扩展：</p><div class=highlight><pre class=chroma><code class=language-swift data-lang=swift><span class=kd>extension</span> <span class=nc>CALayer</span> <span class=p>{</span>
    <span class=kd>func</span> <span class=nf>skt_setShadow</span><span class=p>(</span><span class=n>color</span><span class=p>:</span> <span class=n>UIColor</span><span class=p>?</span> <span class=p>=</span> <span class=p>.</span><span class=n>black</span><span class=p>,</span>
                       <span class=n>alpha</span><span class=p>:</span> <span class=n>CGFloat</span> <span class=p>=</span> <span class=mf>0.5</span><span class=p>,</span>
                       <span class=n>x</span><span class=p>:</span> <span class=n>CGFloat</span> <span class=p>=</span> <span class=mi>0</span><span class=p>,</span> <span class=n>y</span><span class=p>:</span> <span class=n>CGFloat</span> <span class=p>=</span> <span class=mi>2</span><span class=p>,</span>
                       <span class=n>blur</span><span class=p>:</span> <span class=n>CGFloat</span> <span class=p>=</span> <span class=mi>4</span><span class=p>,</span>
                       <span class=n>spread</span><span class=p>:</span> <span class=n>CGFloat</span> <span class=p>=</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>shadowOffset</span> <span class=p>=</span> <span class=n>CGSize</span><span class=p>(</span><span class=n>width</span><span class=p>:</span> <span class=n>x</span><span class=p>,</span> <span class=n>height</span><span class=p>:</span> <span class=n>y</span><span class=p>)</span>
        <span class=n>shadowRadius</span> <span class=p>=</span> <span class=n>blur</span> <span class=o>*</span> <span class=mf>0.5</span>
        <span class=n>shadowColor</span> <span class=p>=</span> <span class=n>color</span><span class=p>?</span><span class=p>.</span><span class=n>cgColor</span>
        <span class=n>shadowOpacity</span> <span class=p>=</span> <span class=nb>Float</span><span class=p>(</span><span class=n>alpha</span><span class=p>)</span>

        <span class=kd>let</span> <span class=nv>rect</span> <span class=p>=</span> <span class=n>bounds</span><span class=p>.</span><span class=n>insetBy</span><span class=p>(</span><span class=n>dx</span><span class=p>:</span> <span class=o>-</span><span class=n>spread</span><span class=p>,</span> <span class=n>dy</span><span class=p>:</span> <span class=o>-</span><span class=n>spread</span><span class=p>)</span>
        <span class=kd>let</span> <span class=nv>path</span> <span class=p>=</span> <span class=n>UIBezierPath</span><span class=p>(</span><span class=n>roundedRect</span><span class=p>:</span> <span class=n>rect</span><span class=p>,</span> <span class=n>cornerRadius</span><span class=p>:</span> <span class=n>cornerRadius</span><span class=p>)</span>
        <span class=n>shadowPath</span> <span class=p>=</span> <span class=n>path</span><span class=p>.</span><span class=n>cgPath</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div><p>使用很简单，传入的值和 Sketch 里的阴影参数一样就行：</p><div class=highlight><pre class=chroma><code class=language-swift data-lang=swift><span class=n>layer</span><span class=p>.</span><span class=n>skt_setShadow</span><span class=p>(</span><span class=n>color</span><span class=p>:</span> <span class=p>.</span><span class=n>black</span><span class=p>,</span> <span class=n>alpha</span><span class=p>:</span> <span class=mf>0.5</span><span class=p>,</span>
                    <span class=n>x</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span> <span class=n>y</span><span class=p>:</span> <span class=mi>10</span><span class=p>,</span> 
                    <span class=n>blur</span><span class=p>:</span> <span class=mi>20</span><span class=p>,</span> 
                    <span class=n>spread</span><span class=p>:</span> <span class=mi>10</span><span class=p>)</span>
</code></pre></div></article><section class=article-labels><a class="article-tag li" href=/tags/ios/><span class=hashtag>#</span>iOS</a></section><section class=article-navigation><p><a class=link href=/posts/2019/11/20_git_tricks/><span class=li></span>Git 操作技巧</a></p><p><a class=link href=/posts/2019/11/18_iosdevicesupport/><span class=li></span>给 Xcode 添加最新的 iOS DeviceSupport</a class="link"></p></section></div><section id=footer class="footer max-body-width"><div style=display:flex;flex-direction:row;justify-content:space-between><p>&copy;2019 LayoutBoy.</p><p><span>Powered by </span><a href=https://gohugo.io>Hugo</a><span> and the </span><a href=https://themes.gohugo.io/hugo-notepadium/>Notepadium</a></p></div></section><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-155172933-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></div></body></html>