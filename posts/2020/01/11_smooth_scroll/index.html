<!doctype html><html lang=zh><meta charset=utf-8><meta name=generator content="Hugo 0.74.2"><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><meta name=color-scheme content="light dark"><meta name=supported-color-schemes content="light dark"><title>iOS 无卡顿同时使用圆角、阴影和边框&nbsp;&ndash;&nbsp;页面仔的笔记</title><link rel=stylesheet href=/css/core.min.a95d1e82cc358fcfc4c26304d00d80603a56a57c82394307367b84bdb3755a3597f5a67e4726884fe02aaf9575c69e29.css integrity=sha384-qV0egsw1j8/EwmME0A2AYDpWpXyCOUMHNnuEvbN1WjWX9aZ+RyaIT+Aqr5V1xp4p><meta name=twitter:card content="summary"><meta name=twitter:title content="iOS 无卡顿同时使用圆角、阴影和边框"><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#00a300"><meta name=theme-color content="#ffffff"><body><section id=header><div class="header wrap"><span class="header left-side"><a class="site home" href=/><img class="site logo" src=/apple-touch-icon.png alt><span class="site name">页面仔的笔记</span></a></span>
<span class="header right-side"><a class="nav item" href=/themes/>Themes</a>
<a class="nav item" href=/dockerhub/><span class="iconfont icon-docker"></span>&nbsp;Docker</a>
<a class="nav item" href=https://github.com/cntrump target=_blank><span class="iconfont icon-github"></span>&nbsp;Github</a></span></div><div class="site slogan"><span class=title>~ Talk is cheap, show me code ~</span></div></section><section id=content><div class=article-container><section class="article header"><h1 class="article title">iOS 无卡顿同时使用圆角、阴影和边框</h1><p class="article date">Jan 11, 2020<span class=reading-time> • 预计阅读时间 1 分钟</span></p></section><article class="article markdown-body"><blockquote><p>在 iOS 开发中，最怕看到设计稿里圆角、阴影和边框同时出现，这三兄弟简直就是性能杀手。</p></blockquote><p>优化的方法百度一下有很多，虽然方法不同但是原理都一样。</p><p>分享一个我自己一直使用的方法：在一个 View 里只应用一种效果，然后通过组合的方式达到效果。</p><div class=highlight><pre class=chroma><code class=language-objc data-lang=objc><span class=n>override</span> <span class=nf>init</span><span class=p>(</span><span class=nl>frame</span><span class=p>:</span> <span class=n>CGRect</span><span class=p>)</span> <span class=p>{</span>
    <span class=nb>super</span><span class=p>.</span><span class=n>init</span><span class=p>(</span><span class=nl>frame</span><span class=p>:</span> <span class=n>frame</span><span class=p>)</span>

    <span class=n>imageView</span> <span class=o>=</span> <span class=n>UIImageView</span><span class=p>(</span><span class=nl>image</span><span class=p>:</span> <span class=n>UIImage</span><span class=p>(</span><span class=nl>named</span><span class=p>:</span> <span class=s>&#34;img&#34;</span><span class=p>))</span>
    <span class=n>imageView</span><span class=p>.</span><span class=n>layer</span><span class=p>.</span><span class=n>cornerRadius</span> <span class=o>=</span> <span class=mi>14</span>
    <span class=n>imageView</span><span class=p>.</span><span class=n>layer</span><span class=p>.</span><span class=n>masksToBounds</span> <span class=o>=</span> <span class=nb>true</span>
    <span class=n>backgroundView</span> <span class=o>=</span> <span class=n>imageView</span>

    <span class=n>shadowView</span> <span class=o>=</span> <span class=n>ShadowView</span><span class=p>()</span>
    <span class=n>shadowView</span><span class=p>.</span><span class=n>layer</span><span class=p>.</span><span class=n>cornerRadius</span> <span class=o>=</span> <span class=mi>20</span>
    <span class=n>shadowView</span><span class=p>.</span><span class=n>applyShadow</span><span class=p>(.</span><span class=n>black</span><span class=p>,</span> <span class=n>CGSize</span><span class=p>(</span><span class=nl>width</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span> <span class=nl>height</span><span class=p>:</span> <span class=mi>15</span><span class=p>),</span> <span class=mf>0.2</span><span class=p>,</span> <span class=mi>40</span><span class=p>)</span>
    <span class=n>insertSubview</span><span class=p>(</span><span class=n>shadowView</span><span class=p>,</span> <span class=nl>belowSubview</span><span class=p>:</span> <span class=n>imageView</span><span class=p>)</span>

    <span class=n>contentView</span><span class=p>.</span><span class=n>layer</span><span class=p>.</span><span class=n>cornerRadius</span> <span class=o>=</span> <span class=mi>14</span>
    <span class=n>contentView</span><span class=p>.</span><span class=n>layer</span><span class=p>.</span><span class=n>borderWidth</span> <span class=o>=</span> <span class=mi>1</span>
    <span class=n>contentView</span><span class=p>.</span><span class=n>layer</span><span class=p>.</span><span class=n>borderColor</span> <span class=o>=</span> <span class=n>UIColor</span><span class=p>.</span><span class=n>orange</span><span class=p>.</span><span class=n>cgColor</span>
    <span class=n>contentView</span><span class=p>.</span><span class=n>layer</span><span class=p>.</span><span class=n>masksToBounds</span> <span class=o>=</span> <span class=nb>true</span>
<span class=p>}</span>
</code></pre></div><p><span class=image-container><span class=link><img class=img src=01.png alt></span><span class=caption><span class=title>生成的视图结构</span></span></span></p><p>层次结构：</p><ul><li><p><code>contentView</code>： 边框和圆角，放在最上层。</p></li><li><p><code>imageView</code>： 背景颜色或者背景图，放在中间层。</p></li><li><p><code>shadowView</code>： 阴影，放在最底层。</p></li></ul><p>每一个视图只负责一个事务，GPU 处理很快，就不需要离屏渲染。</p><h3 id=demo>Demo</h3><p>使用 <code>UICollectionView</code> 进行滚动测试，生成的 Cell 数量是 1 万个。</p><p>测试机器是 <code>5s</code> + <code>iOS 12.4.4</code>，快速滑动无任何卡顿。</p><p><a href=https://github.com/cntrump/shadow_view_demo>https://github.com/cntrump/shadow_view_demo</a></p></article><section class="article labels"><a class=tag href=/tags/ios/>iOS</a></section><section class="article license">版权声明：如果转发请带上本文链接和注明来源。</section><section class="article author"><img class=avatar src=/img/avatar.jpg alt><p class=name>lvv.me</p><div class=bio><strong>iOS/macOS</strong> Developer</div><div class=details><a class=item href=https://github.com/cntrump target=_blank><span class="iconfont icon-github"></span>&nbsp;cntrump</a><a class=item href=https://hub.docker.com/u/cntrump target=_blank><span class="iconfont icon-docker"></span>&nbsp;cntrump</a></div></section></div><div class="article bottom"><section class="article navigation"><p><a class=link href=/posts/2020/01/15_down_app_ipa/><span class="iconfont icon-article"></span>macOS 上下载 iOS APP 安装包</a></p><p><a class=link href=/posts/2020/01/11_macos_httpserver/><span class="iconfont icon-article"></span>macOS 上开启内置的 HTTP Server</a></p></section></div></section><section id=footer><div class=footer-wrap><p class=copyright>&copy;2020 lvvme.</p><p class=powerby><span>Powered&nbsp;by&nbsp;</span><a href=https://gohugo.io target=_blank>Hugo</a><span>&nbsp;&&nbsp;</span><a href=https://themes.gohugo.io/hugo-notepadium/ target=_blank>Notepadium</a></p><p style=font-size:12px><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=44030502005645" target=_blank rel="noopener noreferrer"><img style=vertical-align:text-bottom;width:15px;height:15px src=/assets/img/gonganlogo.png>粤公网安备 44030502005645号</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href=http://www.beian.miit.gov.cn/ target=_blank rel="noopener noreferrer">粤ICP备20056596号-1</a></p></div></section><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-155172933-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></body></html>