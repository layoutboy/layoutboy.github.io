<!doctype html><html lang=zh><meta charset=utf-8><meta name=generator content="Hugo 0.62.2"><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><meta name=color-scheme content="light dark"><meta name=supported-color-schemes content="light dark"><title>iOS 无卡顿同时使用圆角、阴影和边框&nbsp;&ndash;&nbsp;&#xF8FF;页面仔的笔记</title><link rel=stylesheet href=/css/core.min.1b43e093384f1c71b8c40b6345100ead64cf40bd3e02b7d9fb2ae110debcba2d525fa8c3518b9c90a71a65574be45a47.css integrity=sha384-G0PgkzhPHHG4xAtjRRAOrWTPQL0+ArfZ+yrhEN68ui1SX6jDUYuckKcaZVdL5FpH><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#00a300"><meta name=theme-color content="#ffffff"><body><div class=base-body><section id=header class="site header"><div class="header wrap"><span class="header left-side"><a class="site home" href=/><img class="site logo" src=/apple-touch-icon.png alt><span class="site name">&#xF8FF;页面仔的笔记</span></a></span>
<span class="header right-side"><a class="nav item" href=https://github.com/cntrump target=_blank><span class="iconfont icon-logo_github"></span>&nbsp;Github</a></span></div><div class="site slogan"><span class=title>~ 需求使我快乐 ~</span></div></section><div id=content><section class="article header"><h1 class="article title">iOS 无卡顿同时使用圆角、阴影和边框</h1><p class="article date">Jan 11, 2020<span class=reading-time> • 预计阅读时间 1 分钟</span></p></section><article class="article markdown-body"><blockquote><p>在 iOS 开发中，最怕看到设计稿里圆角、阴影和边框同时出现，这三兄弟简直就是性能杀手。</p></blockquote><p>优化的方法百度一下有很多，虽然方法不同但是原理都一样。</p><p>分享一个我自己一直使用的方法：在一个 View 里只应用一种效果，然后通过组合的方式达到效果。</p><div class=highlight><pre class=chroma><code class=language-objc data-lang=objc><span class=n>override</span> <span class=nf>init</span><span class=p>(</span><span class=nl>frame</span><span class=p>:</span> <span class=n>CGRect</span><span class=p>)</span> <span class=p>{</span>
    <span class=nb>super</span><span class=p>.</span><span class=n>init</span><span class=p>(</span><span class=nl>frame</span><span class=p>:</span> <span class=n>frame</span><span class=p>)</span>

    <span class=n>imageView</span> <span class=o>=</span> <span class=n>UIImageView</span><span class=p>(</span><span class=nl>image</span><span class=p>:</span> <span class=n>UIImage</span><span class=p>(</span><span class=nl>named</span><span class=p>:</span> <span class=sa></span><span class=s>&#34;</span><span class=s>img</span><span class=s>&#34;</span><span class=p>)</span><span class=p>)</span>
    <span class=n>imageView</span><span class=p>.</span><span class=n>layer</span><span class=p>.</span><span class=n>cornerRadius</span> <span class=o>=</span> <span class=mi>14</span>
    <span class=n>imageView</span><span class=p>.</span><span class=n>layer</span><span class=p>.</span><span class=n>masksToBounds</span> <span class=o>=</span> <span class=nb>true</span>
    <span class=n>backgroundView</span> <span class=o>=</span> <span class=n>imageView</span>

    <span class=n>shadowView</span> <span class=o>=</span> <span class=n>ShadowView</span><span class=p>(</span><span class=p>)</span>
    <span class=n>shadowView</span><span class=p>.</span><span class=n>layer</span><span class=p>.</span><span class=n>cornerRadius</span> <span class=o>=</span> <span class=mi>20</span>
    <span class=n>shadowView</span><span class=p>.</span><span class=n>applyShadow</span><span class=p>(</span><span class=p>.</span><span class=n>black</span><span class=p>,</span> <span class=n>CGSize</span><span class=p>(</span><span class=nl>width</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span> <span class=nl>height</span><span class=p>:</span> <span class=mi>15</span><span class=p>)</span><span class=p>,</span> <span class=mf>0.2</span><span class=p>,</span> <span class=mi>40</span><span class=p>)</span>
    <span class=n>insertSubview</span><span class=p>(</span><span class=n>shadowView</span><span class=p>,</span> <span class=nl>belowSubview</span><span class=p>:</span> <span class=n>imageView</span><span class=p>)</span>

    <span class=n>contentView</span><span class=p>.</span><span class=n>layer</span><span class=p>.</span><span class=n>cornerRadius</span> <span class=o>=</span> <span class=mi>14</span>
    <span class=n>contentView</span><span class=p>.</span><span class=n>layer</span><span class=p>.</span><span class=n>borderWidth</span> <span class=o>=</span> <span class=mi>1</span>
    <span class=n>contentView</span><span class=p>.</span><span class=n>layer</span><span class=p>.</span><span class=n>borderColor</span> <span class=o>=</span> <span class=n>UIColor</span><span class=p>.</span><span class=n>orange</span><span class=p>.</span><span class=n>cgColor</span>
    <span class=n>contentView</span><span class=p>.</span><span class=n>layer</span><span class=p>.</span><span class=n>masksToBounds</span> <span class=o>=</span> <span class=nb>true</span>
<span class=p>}</span>
</code></pre></div><p><span class=image-container><span class=link><a target=_blank rel="noopener noreferrer" href=01.png><img class=img src=01.png alt></a></span><span class=caption><span class=title>生成的视图结构</span></span></span></p><p>层次结构：</p><ul><li><p><code>contentView</code>： 边框和圆角，放在最上层。</p></li><li><p><code>imageView</code>： 背景颜色或者背景图，放在中间层。</p></li><li><p><code>shadowView</code>： 阴影，放在最底层。</p></li></ul><p>每一个视图只负责一个事务，GPU 处理很快，就不需要离屏渲染。</p><h3 id=demo>Demo</h3><p>使用 <code>UICollectionView</code> 进行滚动测试，生成的 Cell 数量是 1 万个。</p><p>测试机器是 <code>5s</code> + <code>iOS 12.4.4</code>，快速滑动无任何卡顿。</p><p><a href=https://github.com/cntrump/shadow_view_demo>https://github.com/cntrump/shadow_view_demo</a></p></article><section class="article labels"><a class=tag href=/tags/ios/>iOS</a></section><section class="article navigation"><p><a class=link href=/posts/2020/01/15_down_app_ipa/><span class=li>&larr;</span>macOS 上下载 iOS APP 安装包</a></p><p><a class=link href=/posts/2020/01/11_macos_httpserver/><span class=li>&rarr;</span>macOS 上开启内置的 HTTP Server</a class="link"></p></section><section class="article discussion"><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return;}
var d=document,s=d.createElement('script');s.async=true;s.src='//'+"layoutboy"+'.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></section></div><section id=footer class=footer><div class=footer-wrap><p class=copyright>&copy;2020 LayoutBoy.</p><p class=powerby><span>Powered by </span><a href=https://gohugo.io target=_blank>Hugo</a><span> and the </span><a href=https://themes.gohugo.io/hugo-notepadium/ target=_blank>Notepadium</a></p></div></section><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-155172933-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></div></body></html>